---
layout: default
title: Reading Tracker
description: Track your reading progress, set yearly goals, and get AI-powered recommendations based on what you've loved.
permalink: /tools/reading-tracker/
---

<div class="rt-hero">
  <div class="rt-hero-inner">
    <div class="tool-label">
      <span class="tool-label-line"></span>
      <span>Reader's Tool</span>
    </div>
    <h1>Reading <em>Tracker</em></h1>
    <p>Track every book â€” from your TBR pile through to finished reads.</p>
  </div>
</div>

<!-- STICKY TAB BAR -->
<div class="rt-tabbar-wrap" id="rt-tabbar-wrap">
  <div class="rt-tabbar">
    <button class="rt-tab active" data-tab="home"      onclick="switchTab('home')">
      <span class="rt-tab-icon">â—ˆ</span> Home
    </button>
    <button class="rt-tab" data-tab="add"       onclick="switchTab('add')">
      <span class="rt-tab-icon">ï¼‹</span> Add book
    </button>
    <button class="rt-tab" data-tab="tbr"       onclick="switchTab('tbr')">
      <span class="rt-tab-icon">ðŸ”–</span> TBR
    </button>
    <button class="rt-tab" data-tab="recs"      onclick="switchTab('recs')">
      <span class="rt-tab-icon">âœ¦</span> Recs
    </button>
    <button class="rt-tab rt-tab--soon" data-tab="save" onclick="switchTab('save')">
      <span class="rt-tab-icon">âœ‰</span> Save list
    </button>
  </div>
</div>

<!-- PANELS -->
<div class="rt-app">
  <div class="rt-panels">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         HOME / DASHBOARD
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="rt-panel" id="rt-panel-home" data-tab="home">
      <div class="rt-panel-inner">

        <!-- Currently reading -->
        <div class="rt-home-section">
          <div class="rt-home-section-header">
            <h2 class="rt-section-heading">Currently reading</h2>
            <button class="rt-ghost-btn" onclick="switchTab('add')">+ Start a new book</button>
          </div>

          <div id="rt-home-reading-list"></div>

          <div class="rt-empty rt-empty--inline" id="rt-home-reading-empty">
            <p>Nothing in progress yet. <button class="btn-text-link" onclick="switchTab('add')">Start reading something â†’</button></p>
          </div>
        </div>

        <!-- Stats -->
        <div class="rt-home-section">
          <h2 class="rt-section-heading">Your reading year</h2>
          <div class="rt-stats-grid">
            <div class="rt-stat-card rt-stat-goal">
              <div class="rt-stat-label">Goal</div>
              <div class="rt-goal-display">
                <span class="rt-goal-current" id="rt-goal-count">0</span>
                <span class="rt-goal-sep">/</span>
                <input type="number" class="rt-goal-input" id="rt-goal-target" value="12" min="1" max="365" aria-label="Yearly goal">
                <span class="rt-goal-unit">this year</span>
              </div>
              <div class="rt-goal-bar-wrap">
                <div class="rt-goal-bar"><div class="rt-goal-fill" id="rt-goal-fill" style="width:0%"></div></div>
                <span class="rt-goal-pct" id="rt-goal-pct">0%</span>
              </div>
            </div>
            <div class="rt-stat-card">
              <div class="rt-stat-label">This year</div>
              <div class="rt-stat-number" id="rt-this-year">0</div>
              <div class="rt-stat-sub" id="rt-year-label">2026</div>
            </div>
            <div class="rt-stat-card">
              <div class="rt-stat-label">All time</div>
              <div class="rt-stat-number" id="rt-total">0</div>
              <div class="rt-stat-sub">books read</div>
            </div>
            <div class="rt-stat-card">
              <div class="rt-stat-label">Favourites</div>
              <div class="rt-stat-number" id="rt-favourites">0</div>
              <div class="rt-stat-sub">5â˜… reads</div>
            </div>
          </div>
        </div>

        <!-- Reading history -->
        <div class="rt-home-section">
          <div class="rt-home-section-header">
            <h2 class="rt-section-heading">Reading history</h2>
            <div style="display:flex;gap:0.5rem;">
              <select class="rt-filter-select" id="rt-home-sort">
                <option value="newest">Newest first</option>
                <option value="rating-high">Top rated</option>
                <option value="title">Aâ€“Z</option>
              </select>
            </div>
          </div>

          <div class="rt-status-tabs">
            <button class="rt-status-tab active" data-status="read" onclick="setHomeFilter('read',this)">Finished</button>
            <button class="rt-status-tab" data-status="dnf"  onclick="setHomeFilter('dnf',this)">DNF</button>
          </div>

          <div id="rt-history-list"></div>
          <div class="rt-empty rt-empty--inline" id="rt-history-empty">
            <p id="rt-history-empty-msg">No finished books yet. <button class="btn-text-link" onclick="switchTab('add')">Log your first read â†’</button></p>
          </div>
        </div>

      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         ADD BOOK
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="rt-panel" id="rt-panel-add" data-tab="add" style="display:none;">
      <div class="rt-panel-inner">
        <h2 class="rt-section-heading">Add a book</h2>
        <p class="rt-panel-sub">Adding a book will mark it as currently reading. Fill in rating and notes when you're done.</p>

        <div class="rt-form-card">
          <div class="rt-form-row">
            <div class="rt-field">
              <label for="rt-title">Title <span class="rt-required">*</span></label>
              <input type="text" id="rt-title" placeholder="e.g. The Way of Kings" autocomplete="off">
            </div>
          </div>
          <div class="rt-form-row rt-form-row--2">
            <div class="rt-field">
              <label for="rt-author">Author</label>
              <input type="text" id="rt-author" placeholder="e.g. Brandon Sanderson" autocomplete="off">
            </div>
            <div class="rt-field">
              <label for="rt-genre">Genre</label>
              <select id="rt-genre">
                <option value="">â€” select â€”</option>
                <option value="Fantasy">Fantasy</option>
                <option value="Science Fiction">Science Fiction</option>
                <option value="Horror">Horror</option>
                <option value="Romance">Romance</option>
                <option value="Dystopian">Dystopian</option>
                <option value="Literary Fiction">Literary Fiction</option>
                <option value="Historical Fiction">Historical Fiction</option>
                <option value="Thriller">Thriller</option>
                <option value="Non-Fiction">Non-Fiction</option>
                <option value="Short Stories">Short Stories</option>
                <option value="Other">Other</option>
              </select>
            </div>
          </div>

          <div class="rt-form-row rt-form-row--2">
            <div class="rt-field">
              <label>Status</label>
              <div class="rt-status-toggle">
                <label class="rt-toggle-opt">
                  <input type="radio" name="rt-status" value="reading" checked> Currently reading
                </label>
                <label class="rt-toggle-opt">
                  <input type="radio" name="rt-status" value="read"> Already finished
                </label>
                <label class="rt-toggle-opt">
                  <input type="radio" name="rt-status" value="tbr"> Add to TBR
                </label>
              </div>
            </div>
            <div class="rt-field">
              <label for="rt-date">Date finished</label>
              <input type="date" id="rt-date">
            </div>
          </div>

          <!-- Shown only when "already finished" -->
          <div class="rt-form-row" id="rt-rating-row" style="display:none;">
            <div class="rt-field">
              <label>Rating</label>
              <div class="rt-stars" id="rt-star-input" role="radiogroup" aria-label="Rating">
                <button class="rt-star" data-val="1" type="button">â˜…</button>
                <button class="rt-star" data-val="2" type="button">â˜…</button>
                <button class="rt-star" data-val="3" type="button">â˜…</button>
                <button class="rt-star" data-val="4" type="button">â˜…</button>
                <button class="rt-star" data-val="5" type="button">â˜…</button>
              </div>
            </div>
          </div>

          <div class="rt-form-row" id="rt-notes-row" style="display:none;">
            <div class="rt-field">
              <label for="rt-notes">Notes <span class="rt-optional">(optional â€” helps personalise your recommendations)</span></label>
              <textarea id="rt-notes" rows="3" placeholder="What did you think?"></textarea>
            </div>
          </div>

          <div class="rt-form-row">
            <button class="rt-submit-btn" id="rt-add-btn" type="button">Add book</button>
          </div>

          <div class="rt-add-success" id="rt-add-success" style="display:none;">
            <span>âœ“</span>&nbsp;<span id="rt-add-success-msg">Added!</span>
            <button class="btn-text-link" onclick="switchTab('home')">Back to home â†’</button>
          </div>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         TBR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="rt-panel" id="rt-panel-tbr" data-tab="tbr" style="display:none;">
      <div class="rt-panel-inner">
        <h2 class="rt-section-heading">To be read</h2>
        <p class="rt-panel-sub">Books you want to read next. Hit "Start reading" to move one to your current reads.</p>

        <div class="rt-tbr-add">
          <input type="text" id="rt-tbr-title"  class="rt-tbr-input" placeholder="Book title..." autocomplete="off">
          <input type="text" id="rt-tbr-author" class="rt-tbr-input" placeholder="Author (optional)" autocomplete="off">
          <button class="rt-tbr-add-btn" id="rt-tbr-add-btn" type="button">+ Add</button>
        </div>

        <div id="rt-tbr-list"></div>
        <div class="rt-empty rt-empty--inline" id="rt-tbr-empty">
          <p>Your TBR pile is empty â€” <button class="btn-text-link" onclick="switchTab('recs')">get some recommendations â†’</button></p>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         RECS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="rt-panel" id="rt-panel-recs" data-tab="recs" style="display:none;">
      <div class="rt-panel-inner">
        <div class="rt-recs-header">
          <div>
            <div class="section-label" style="margin-bottom:0.4rem;">Powered by Claude</div>
            <h2 class="rt-section-heading" style="margin-bottom:0.3rem;">What should I read next?</h2>
            <p class="rt-panel-sub">Claude reads your full history â€” ratings, DNFs, genres, notes â€” and recommends books matched to your actual taste. The more you log, the better it gets.</p>
          </div>
          <div class="rt-ai-badge">AI</div>
        </div>
        <button class="rt-submit-btn" id="rt-ai-btn" type="button">âœ¦ Get recommendations</button>
        <div class="rt-ai-output" id="rt-ai-output" style="display:none;"></div>
        <p class="rt-ai-note" id="rt-ai-note" style="display:none;">Recommendations generated by Claude (Anthropic). Not affiliated with any retailer.</p>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         SAVE LIST (coming soon)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="rt-panel" id="rt-panel-save" data-tab="save" style="display:none;">
      <div class="rt-panel-inner">
        <div class="rt-coming-soon-card">
          <div class="rt-coming-soon-icon">âœ‰</div>
          <h2 class="rt-section-heading">Save &amp; backup your list</h2>
          <p>Your reading data lives in your browser â€” which means it could be lost if you clear your cache or switch devices.</p>
          <p>We're building an email backup feature that will let you:</p>
          <ul class="rt-coming-soon-list">
            <li>Email yourself your full TBR list and reading history</li>
            <li>Get a monthly digest with your stats and top picks</li>
            <li>Restore your list on any device</li>
          </ul>
          <p class="rt-coming-soon-note">Coming soon. In the meantime, <strong>bookmark this page</strong> and don't clear your browser data.</p>
          <a href="{{ '/newsletter/' | relative_url }}" class="rt-submit-btn" style="display:inline-block; text-decoration:none; text-align:center; max-width:300px;">
            Join the newsletter to be notified â†’
          </a>
        </div>
      </div>
    </div>

  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MOBILE BOTTOM NAV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<nav class="rt-bottom-nav" aria-label="Tracker navigation">
  <button class="rt-nav-btn active" data-tab="home" onclick="switchTab('home')">
    <span class="rt-nav-icon">â—ˆ</span>
    <span class="rt-nav-label">Home</span>
  </button>
  <button class="rt-nav-btn" data-tab="add" onclick="switchTab('add')">
    <span class="rt-nav-icon">ï¼‹</span>
    <span class="rt-nav-label">Add</span>
  </button>
  <button class="rt-nav-btn" data-tab="tbr" onclick="switchTab('tbr')">
    <span class="rt-nav-icon">ðŸ”–</span>
    <span class="rt-nav-label">TBR</span>
  </button>
  <button class="rt-nav-btn" data-tab="recs" onclick="switchTab('recs')">
    <span class="rt-nav-icon">âœ¦</span>
    <span class="rt-nav-label">Recs</span>
  </button>
  <button class="rt-nav-btn" data-tab="save" onclick="switchTab('save')">
    <span class="rt-nav-icon">âœ‰</span>
    <span class="rt-nav-label">Save</span>
  </button>
</nav>

<!-- FINISH MODAL -->
<div class="rt-modal-overlay" id="rt-modal-overlay" style="display:none;" aria-modal="true" role="dialog">
  <div class="rt-modal">
    <div class="rt-modal-header">
      <h3 id="rt-modal-title">How was it?</h3>
      <button class="rt-modal-close" id="rt-modal-close" aria-label="Close" type="button">Ã—</button>
    </div>
    <input type="hidden" id="rt-modal-book-id">

    <div class="rt-field" style="margin-bottom:1rem;">
      <label>Rating <span class="rt-optional">(optional)</span></label>
      <div class="rt-stars rt-stars--large" id="rt-modal-stars" role="radiogroup">
        <button class="rt-star" data-val="1" type="button">â˜…</button>
        <button class="rt-star" data-val="2" type="button">â˜…</button>
        <button class="rt-star" data-val="3" type="button">â˜…</button>
        <button class="rt-star" data-val="4" type="button">â˜…</button>
        <button class="rt-star" data-val="5" type="button">â˜…</button>
      </div>
    </div>

    <div class="rt-field" style="margin-bottom:1rem;">
      <label for="rt-modal-notes">Notes <span class="rt-optional">(helps personalise your recommendations)</span></label>
      <textarea id="rt-modal-notes" rows="3" placeholder="What did you think? Even a few words helps..."></textarea>
    </div>

    <div class="rt-field" style="margin-bottom:1.5rem;">
      <label for="rt-modal-date">Date finished</label>
      <input type="date" id="rt-modal-date">
    </div>

    <div class="rt-modal-actions">
      <button class="rt-modal-btn rt-modal-btn--read"   id="rt-modal-mark-read"  type="button">âœ“ Mark as read</button>
      <button class="rt-modal-btn rt-modal-btn--dnf"    id="rt-modal-mark-dnf"   type="button">Did not finish</button>
      <button class="rt-modal-btn rt-modal-btn--cancel" id="rt-modal-cancel"     type="button">Cancel</button>
    </div>
  </div>
</div>

<!-- INSTALL STRIP -->
<div class="rt-install-strip" id="rt-install-strip">
  <div class="rt-install-strip-inner">
    <span>ðŸ“± <strong>Add to home screen</strong> â€” your data saves automatically in your browser.</span>
    <span id="rt-install-chrome" style="display:none;">
      <button class="rt-install-btn" id="rt-install-btn" type="button">Install app</button>
    </span>
    <em class="rt-ios-hint">iPhone: Share â†’ "Add to Home Screen"</em>
  </div>
</div>

<script>
'use strict';
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DATA MODEL
// book = { id, title, author, genre, status, rating, notes,
//          date (finished), dateStarted, added }
// status: 'tbr' | 'reading' | 'read' | 'dnf'
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SK = 'ctb_tracker_v2';
const GK = 'ctb_reading_goal_v1';

let books       = [];
let modalRating = 0;
let addRating   = 0;
let histFilter  = 'read';

function save()      { try { localStorage.setItem(SK, JSON.stringify(books)); } catch(e){} }
function saveGoal(v) { try { localStorage.setItem(GK, v); } catch(e){} }
function loadGoal()  { try { return parseInt(localStorage.getItem(GK)) || 12; } catch(e){ return 12; } }

function load() {
  try { books = JSON.parse(localStorage.getItem(SK)) || []; } catch(e){ books = []; }
  // Migrate from old key
  if (!books.length) {
    try {
      const old = JSON.parse(localStorage.getItem('ctb_reading_tracker_v1'));
      if (old && old.length) { books = old.map(b => ({...b, status: b.status || 'read'})); save(); }
    } catch(e){}
  }
}

function getBooks(status) { return books.filter(b => b.status === status); }
function uid() { return Date.now() + Math.floor(Math.random() * 1000); }
function esc(s) {
  const d = document.createElement('div');
  d.appendChild(document.createTextNode(s || ''));
  return d.innerHTML;
}
function fmtDate(s) {
  if (!s) return '';
  return new Date(s + 'T12:00:00').toLocaleDateString('en-GB', {day:'numeric', month:'short', year:'numeric'});
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TAB SWITCHING â€” syncs both top bar and bottom nav
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(name) {
  document.querySelectorAll('.rt-panel').forEach(p => p.style.display = 'none');
  document.querySelectorAll('.rt-tab, .rt-nav-btn').forEach(b => b.classList.remove('active'));

  const panel = document.getElementById('rt-panel-' + name);
  if (panel) panel.style.display = 'block';
  document.querySelectorAll(`[data-tab="${name}"]`).forEach(b => b.classList.add('active'));

  if (name === 'home') { updateStats(); renderHomeReading(); renderHistory(); }
  if (name === 'tbr')  { renderTBR(); }

  // Scroll to top of app
  const wrap = document.querySelector('.rt-tabbar-wrap');
  if (wrap) window.scrollTo({ top: wrap.offsetTop - 10, behavior: 'smooth' });
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateStats() {
  const year = new Date().getFullYear();
  const read  = getBooks('read');
  const ty    = read.filter(b => b.date && new Date(b.date).getFullYear() === year);
  const fav   = read.filter(b => b.rating === 5);
  const goal  = parseInt(document.getElementById('rt-goal-target').value) || 12;
  const pct   = Math.min(100, Math.round((ty.length / goal) * 100));

  document.getElementById('rt-year-label').textContent  = year;
  document.getElementById('rt-total').textContent       = read.length;
  document.getElementById('rt-this-year').textContent   = ty.length;
  document.getElementById('rt-favourites').textContent  = fav.length;
  document.getElementById('rt-goal-count').textContent  = ty.length;
  document.getElementById('rt-goal-fill').style.width   = pct + '%';
  document.getElementById('rt-goal-pct').textContent    = pct + '%';
}

const gi = document.getElementById('rt-goal-target');
gi.value = loadGoal();
gi.addEventListener('change', function() { saveGoal(this.value); updateStats(); });

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HOME â€” CURRENTLY READING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderHomeReading() {
  const reading = getBooks('reading');
  const list    = document.getElementById('rt-home-reading-list');
  const empty   = document.getElementById('rt-home-reading-empty');

  empty.style.display = reading.length ? 'none' : 'flex';
  list.innerHTML = reading.map(b => `
    <div class="rt-reading-card">
      <div class="rt-reading-card-body">
        <div class="rt-reading-badge">Currently reading</div>
        <div class="rt-reading-title">${esc(b.title)}</div>
        ${b.author ? `<div class="rt-reading-author">${esc(b.author)}</div>` : ''}
        ${b.dateStarted ? `<div class="rt-reading-meta">Started ${fmtDate(b.dateStarted)}</div>` : ''}
      </div>
      <div class="rt-reading-card-actions">
        <button class="rt-finish-btn" data-id="${b.id}" type="button">Finished?</button>
        <button class="rt-delete rt-delete--quiet" data-id="${b.id}" data-action="remove-reading" title="Remove" type="button">Ã—</button>
      </div>
    </div>`).join('');
}

// Event delegation for home reading list
document.getElementById('rt-home-reading-list').addEventListener('click', function(e) {
  const finBtn = e.target.closest('.rt-finish-btn');
  if (finBtn) {
    openModal(Number(finBtn.dataset.id));
    return;
  }
  const delBtn = e.target.closest('[data-action="remove-reading"]');
  if (delBtn && confirm('Remove from currently reading?')) {
    books = books.filter(b => b.id !== Number(delBtn.dataset.id));
    save(); renderHomeReading();
  }
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HOME â€” HISTORY
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setHomeFilter(status, btn) {
  histFilter = status;
  document.querySelectorAll('#rt-panel-home .rt-status-tab').forEach(t => t.classList.remove('active'));
  if (btn) btn.classList.add('active');
  document.getElementById('rt-history-empty-msg').textContent =
    status === 'read' ? 'No finished books yet.' : 'No DNF books logged.';
  renderHistory();
}

function renderHistory() {
  const so   = document.getElementById('rt-home-sort').value;
  let   list = getBooks(histFilter).sort((a,b) => {
    if (so === 'newest')      return new Date(b.date||b.added) - new Date(a.date||a.added);
    if (so === 'rating-high') return (b.rating||0) - (a.rating||0);
    if (so === 'title')       return a.title.localeCompare(b.title);
    return 0;
  });

  const el    = document.getElementById('rt-history-list');
  const empty = document.getElementById('rt-history-empty');
  empty.style.display = list.length ? 'none' : 'flex';
  if (!list.length) { el.innerHTML = ''; return; }

  el.innerHTML = list.map(b => `
    <div class="rt-book-item ${b.status==='dnf' ? 'rt-book-item--dnf' : ''}">
      <div class="rt-book-main">
        <div class="rt-book-info">
          <div class="rt-book-title">${esc(b.title)}${b.status==='dnf' ? ' <span class="rt-dnf-label">DNF</span>' : ''}</div>
          ${b.author ? `<div class="rt-book-author">${esc(b.author)}</div>` : ''}
        </div>
        <div class="rt-book-meta">
          ${b.genre  ? `<span class="rt-book-genre">${esc(b.genre)}</span>` : ''}
          ${b.rating ? `<span class="rt-book-stars">${'â˜…'.repeat(b.rating)}${'â˜†'.repeat(5-b.rating)}</span>` : ''}
          ${b.date   ? `<span class="rt-book-date">${fmtDate(b.date)}</span>` : ''}
          <button class="rt-delete" data-id="${b.id}" data-action="remove-hist" title="Remove" type="button">Ã—</button>
        </div>
      </div>
      ${b.notes ? `<div class="rt-book-notes">${esc(b.notes)}</div>` : ''}
    </div>`).join('');
}

document.getElementById('rt-history-list').addEventListener('click', function(e) {
  const btn = e.target.closest('[data-action="remove-hist"]');
  if (btn && confirm('Remove this book from your history?')) {
    books = books.filter(b => b.id !== Number(btn.dataset.id));
    save(); renderHistory(); updateStats();
  }
});

document.getElementById('rt-home-sort').addEventListener('change', renderHistory);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// ADD BOOK
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// Show/hide rating+notes based on status selection
document.querySelectorAll('input[name="rt-status"]').forEach(radio => {
  radio.addEventListener('change', function() {
    const isRead = this.value === 'read';
    document.getElementById('rt-rating-row').style.display = isRead ? 'flex' : 'none';
    document.getElementById('rt-notes-row').style.display  = isRead ? 'flex' : 'none';
  });
});

// Star rating for add form
function setAddStars(v) {
  addRating = v;
  document.querySelectorAll('#rt-star-input .rt-star').forEach((s,i) => s.classList.toggle('active', i < v));
}
const addStarWrap = document.getElementById('rt-star-input');
addStarWrap.addEventListener('click', e => {
  const b = e.target.closest('.rt-star'); if (!b) return;
  const v = parseInt(b.dataset.val);
  setAddStars(addRating === v ? 0 : v);
});
addStarWrap.addEventListener('mouseover', e => {
  const b = e.target.closest('.rt-star'); if (!b) return;
  const v = parseInt(b.dataset.val);
  document.querySelectorAll('#rt-star-input .rt-star').forEach((s,i) => s.classList.toggle('hover', i < v));
});
addStarWrap.addEventListener('mouseleave', () =>
  document.querySelectorAll('#rt-star-input .rt-star').forEach(s => s.classList.remove('hover')));

document.getElementById('rt-add-btn').addEventListener('click', function() {
  const titleEl = document.getElementById('rt-title');
  const title   = titleEl.value.trim();
  if (!title) {
    titleEl.focus();
    titleEl.classList.add('rt-input-error');
    setTimeout(() => titleEl.classList.remove('rt-input-error'), 1500);
    return;
  }
  const status  = document.querySelector('input[name="rt-status"]:checked').value;
  const book = {
    id:          uid(),
    title,
    author:      document.getElementById('rt-author').value.trim(),
    genre:       document.getElementById('rt-genre').value,
    status,
    rating:      status === 'read' ? addRating || null : null,
    notes:       status === 'read' ? document.getElementById('rt-notes').value.trim() : null,
    date:        status === 'read' ? (document.getElementById('rt-date').value || new Date().toISOString().split('T')[0]) : null,
    dateStarted: status === 'reading' ? new Date().toISOString().split('T')[0] : null,
    added:       new Date().toISOString()
  };
  books.unshift(book);
  save();

  // Reset form
  ['rt-title','rt-author','rt-notes'].forEach(id => document.getElementById(id).value = '');
  document.getElementById('rt-genre').value = '';
  document.querySelector('input[name="rt-status"][value="reading"]').checked = true;
  document.getElementById('rt-rating-row').style.display = 'none';
  document.getElementById('rt-notes-row').style.display  = 'none';
  setAddStars(0);

  const msgs = { reading:'Started! You can mark it as finished from the Home tab.', read:'Logged!', tbr:'Added to your TBR pile.' };
  const s = document.getElementById('rt-add-success');
  document.getElementById('rt-add-success-msg').textContent = msgs[status] || 'Added!';
  s.style.display = 'flex';
  setTimeout(() => s.style.display = 'none', 4000);
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TBR
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTBR() {
  const tbr   = getBooks('tbr');
  const list  = document.getElementById('rt-tbr-list');
  const empty = document.getElementById('rt-tbr-empty');
  empty.style.display = tbr.length ? 'none' : 'flex';

  list.innerHTML = tbr.map(b => `
    <div class="rt-book-item">
      <div class="rt-book-main">
        <div class="rt-book-info">
          <div class="rt-book-title">${esc(b.title)}</div>
          ${b.author ? `<div class="rt-book-author">${esc(b.author)}</div>` : ''}
        </div>
        <div class="rt-book-meta">
          <button class="rt-start-reading-btn" data-id="${b.id}" type="button">ðŸ“– Start reading</button>
          <button class="rt-delete" data-id="${b.id}" data-action="remove-tbr" title="Remove" type="button">Ã—</button>
        </div>
      </div>
    </div>`).join('');
}

function addToTBR() {
  const title = document.getElementById('rt-tbr-title').value.trim();
  if (!title) { document.getElementById('rt-tbr-title').focus(); return; }
  books.push({ id:uid(), title, author:document.getElementById('rt-tbr-author').value.trim(), status:'tbr', added:new Date().toISOString() });
  save();
  document.getElementById('rt-tbr-title').value  = '';
  document.getElementById('rt-tbr-author').value = '';
  renderTBR();
}

document.getElementById('rt-tbr-add-btn').addEventListener('click', addToTBR);
document.getElementById('rt-tbr-title').addEventListener('keydown',  e => { if(e.key==='Enter') addToTBR(); });
document.getElementById('rt-tbr-author').addEventListener('keydown', e => { if(e.key==='Enter') addToTBR(); });

document.getElementById('rt-tbr-list').addEventListener('click', function(e) {
  const startBtn = e.target.closest('.rt-start-reading-btn');
  if (startBtn) {
    const book = books.find(b => b.id === Number(startBtn.dataset.id));
    if (book) { book.status = 'reading'; book.dateStarted = new Date().toISOString().split('T')[0]; save(); renderTBR(); }
    return;
  }
  const delBtn = e.target.closest('[data-action="remove-tbr"]');
  if (delBtn) { books = books.filter(b => b.id !== Number(delBtn.dataset.id)); save(); renderTBR(); }
});

// Add to TBR from recommendations
function addRecToTBR(title, author) {
  if (books.some(b => b.title.toLowerCase() === title.toLowerCase())) {
    alert(`"${title}" is already in your list.`); return;
  }
  books.push({ id:uid(), title, author:author||'', status:'tbr', added:new Date().toISOString() });
  save();
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FINISH MODAL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(bookId) {
  const book = books.find(b => b.id === bookId);
  if (!book) { console.warn('Book not found:', bookId, books.map(b=>b.id)); return; }

  document.getElementById('rt-modal-book-id').value   = bookId;
  document.getElementById('rt-modal-title').textContent = `"${book.title}"`;
  document.getElementById('rt-modal-notes').value     = '';
  document.getElementById('rt-modal-date').value      = new Date().toISOString().split('T')[0];
  setModalStars(0);
  document.getElementById('rt-modal-overlay').style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

function closeModal() {
  document.getElementById('rt-modal-overlay').style.display = 'none';
  document.body.style.overflow = '';
}

document.getElementById('rt-modal-close').addEventListener('click',  closeModal);
document.getElementById('rt-modal-cancel').addEventListener('click', closeModal);
document.getElementById('rt-modal-overlay').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});

function setModalStars(v) {
  modalRating = v;
  document.querySelectorAll('#rt-modal-stars .rt-star').forEach((s,i) => s.classList.toggle('active', i < v));
}
const ms = document.getElementById('rt-modal-stars');
ms.addEventListener('click', e => {
  const b = e.target.closest('.rt-star'); if (!b) return;
  const v = parseInt(b.dataset.val);
  setModalStars(modalRating === v ? 0 : v);
});
ms.addEventListener('mouseover', e => {
  const b = e.target.closest('.rt-star'); if (!b) return;
  const v = parseInt(b.dataset.val);
  document.querySelectorAll('#rt-modal-stars .rt-star').forEach((s,i) => s.classList.toggle('hover', i < v));
});
ms.addEventListener('mouseleave', () =>
  document.querySelectorAll('#rt-modal-stars .rt-star').forEach(s => s.classList.remove('hover')));

function finishBook(status) {
  const id   = Number(document.getElementById('rt-modal-book-id').value);
  const book = books.find(b => b.id === id);
  if (!book) { closeModal(); return; }

  book.status = status;
  book.date   = document.getElementById('rt-modal-date').value || new Date().toISOString().split('T')[0];
  if (status === 'read') {
    book.rating = modalRating || null;
    book.notes  = document.getElementById('rt-modal-notes').value.trim() || null;
  } else {
    book.notes  = document.getElementById('rt-modal-notes').value.trim() || null;
  }
  save();
  closeModal();
  renderHomeReading();
  updateStats();

  // Flash confirmation
  const label = status === 'read' ? `âœ“ "${book.title}" marked as finished!` : `"${book.title}" marked as DNF.`;
  showFlash(label);
}

document.getElementById('rt-modal-mark-read').addEventListener('click', () => finishBook('read'));
document.getElementById('rt-modal-mark-dnf').addEventListener('click',  () => finishBook('dnf'));

function showFlash(msg) {
  const f = document.createElement('div');
  f.className = 'rt-flash'; f.textContent = msg;
  document.querySelector('.rt-app').prepend(f);
  setTimeout(() => f.remove(), 3200);
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// AI RECOMMENDATIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('rt-ai-btn').addEventListener('click', async function() {
  const read    = getBooks('read');
  const reading = getBooks('reading');

  if (!read.length && !reading.length) {
    const o = document.getElementById('rt-ai-output');
    o.style.display = 'block';
    o.innerHTML = '<p class="rt-ai-msg">Log some books first â€” Claude needs your reading history to make good recommendations!</p>';
    return;
  }

  const btn    = this;
  btn.disabled = true; btn.textContent = 'âœ¦ Thinking...';
  const output = document.getElementById('rt-ai-output');
  const note   = document.getElementById('rt-ai-note');
  output.style.display = 'block';
  output.innerHTML = '<div class="rt-ai-loading"><span></span><span></span><span></span></div>';
  note.style.display = 'none';

  const topRated = read.filter(b => b.rating >= 4).slice(0, 8);
  const sample   = topRated.length ? topRated : read.slice(0, 6);
  const dnf      = getBooks('dnf').slice(0, 4);
  const tbr      = getBooks('tbr').slice(0, 5);
  const genres   = [...new Set(books.map(b => b.genre).filter(Boolean))];

  const fmt = b => `"${b.title}"${b.author ? ` by ${b.author}` : ''}${b.genre ? ` (${b.genre})` : ''}${b.rating ? ` ${b.rating}/5â˜…` : ''}${b.notes ? ` â€” "${b.notes}"` : ''}`;

  const prompt = `You are a knowledgeable book recommender. Here is a reader's reading history:

ENJOYED (rated 4-5â˜…):
${sample.map(fmt).join('\n') || 'None yet'}

CURRENTLY READING:
${reading.map(fmt).join('\n') || 'Nothing'}

DID NOT FINISH:
${dnf.map(b => `"${b.title}"${b.notes ? ` â€” reason: "${b.notes}"` : ''}`).join('\n') || 'None'}

WANTS TO READ (TBR pile):
${tbr.map(b => b.title).join(', ') || 'Empty'}

Genres they read: ${genres.join(', ') || 'mixed'}. Total books finished: ${read.length}.

Recommend exactly 4 books. For each: bold the title and author, one sentence why it fits their specific taste referencing something they've actually read, one sentence on what makes it special. Number 1â€“4.
${tbr.length ? 'After your 4 recommendations, add a single line: "From your TBR list, I\'d start with: [title]" â€” pick whichever TBR book best matches their taste.' : ''}
Warm and direct, like a well-read friend.`;

  try {
    const res  = await fetch('https://api.anthropic.com/v1/messages', {
      method: 'POST',
      headers: {'Content-Type': 'application/json'},
      body: JSON.stringify({ model:'claude-sonnet-4-20250514', max_tokens:1200, messages:[{role:'user', content:prompt}] })
    });
    const data = await res.json();
    const text = data.content?.find(c => c.type === 'text')?.text || '';
    if (!text) throw new Error('empty');

    // Render with Add to TBR buttons on numbered items
    const paras = text.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>').split('\n\n').filter(p => p.trim());
    const html  = paras.map(p => {
      const isNum = /^\d+\./.test(p.trim());
      if (isNum) {
        const strongMatch = p.match(/<strong>([^<]+)<\/strong>/);
        const raw = strongMatch ? strongMatch[1] : '';
        const titlePart  = raw.split(' by ')[0].replace(/["""*]/g,'').trim();
        const authorPart = raw.includes(' by ') ? raw.split(' by ')[1].replace(/["""*]/g,'').trim() : '';
        const safeTitle  = titlePart.replace(/\\/g,'\\\\').replace(/'/g,"\\'");
        const safeAuthor = authorPart.replace(/\\/g,'\\\\').replace(/'/g,"\\'");
        const addBtn = titlePart
          ? `<button class="rt-rec-add-btn" onclick="addRecToTBR('${safeTitle}','${safeAuthor}');this.textContent='âœ“ Added to TBR';this.disabled=true;" type="button">+ Add to TBR</button>`
          : '';
        return `<div class="rt-rec-item"><p>${p}</p>${addBtn}</div>`;
      }
      return `<p class="rt-rec-footer">${p}</p>`;
    }).join('');

    output.innerHTML = `<div class="rt-ai-response">${html}</div>`;
    note.style.display = 'block';
  } catch(err) {
    output.innerHTML = '<p class="rt-ai-msg">Couldn\'t get recommendations right now â€” please try again.</p>';
  }
  btn.disabled = false; btn.textContent = 'âœ¦ Get new recommendations';
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PWA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let deferredPrompt = null;
window.addEventListener('beforeinstallprompt', function(e) {
  e.preventDefault(); deferredPrompt = e;
  document.getElementById('rt-install-chrome').style.display = 'inline';
});
document.getElementById('rt-install-btn').addEventListener('click', async function() {
  if (!deferredPrompt) return;
  deferredPrompt.prompt();
  const {outcome} = await deferredPrompt.userChoice;
  deferredPrompt = null;
  if (outcome === 'accepted') document.getElementById('rt-install-strip').style.display = 'none';
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STICKY TAB BAR
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
(function() {
  const wrap   = document.getElementById('rt-tabbar-wrap');
  const heroH  = () => document.querySelector('.rt-hero').offsetHeight;
  window.addEventListener('scroll', function() {
    wrap.classList.toggle('rt-tabbar--stuck', window.scrollY >= heroH());
  }, {passive: true});
})();

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
load();
updateStats();
renderHomeReading();
renderHistory();
</script>
