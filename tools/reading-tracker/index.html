---
layout: default
title: Reading Tracker
description: Track your reading progress, set yearly goals, and get AI-powered recommendations based on what you've loved.
permalink: /tools/reading-tracker/
---

<div class="tool-hero" style="padding-bottom:1.5rem;">
  <div class="tool-hero-inner">
    <div class="tool-label">
      <span class="tool-label-line"></span>
      <span>Reader's Tool</span>
    </div>
    <h1>Reading <em>Tracker</em></h1>
    <p>Track every book â€” from your TBR pile through to finished reads. Bookmark or install for the best experience.</p>
  </div>
</div>

<div class="rt-app">
  <div class="rt-panels">

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         TAB 1 â€” CURRENTLY READING
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="rt-panel" id="rt-panel-reading" data-tab="reading">
      <div class="rt-panel-inner">
        <h2 class="rt-panel-title">Currently reading</h2>

        <div id="rt-reading-list"></div>

        <div class="rt-empty" id="rt-reading-empty">
          <div class="rt-empty-icon">ðŸ“–</div>
          <p>Nothing in progress. <button class="btn-text-link" onclick="switchTab('tbr')">Pick something from your TBR â†’</button></p>
        </div>

        <div class="rt-add-quick-wrap">
          <h3 class="rt-subsection-title">Start reading something new</h3>
          <div class="rt-quick-add-row">
            <input type="text" id="rt-q-title"  class="rt-tbr-input" placeholder="Title..." autocomplete="off">
            <input type="text" id="rt-q-author" class="rt-tbr-input" placeholder="Author (optional)" autocomplete="off">
            <select id="rt-q-genre" class="rt-tbr-input rt-tbr-select">
              <option value="">Genre...</option>
              <option value="Fantasy">Fantasy</option>
              <option value="Science Fiction">Science Fiction</option>
              <option value="Horror">Horror</option>
              <option value="Romance">Romance</option>
              <option value="Dystopian">Dystopian</option>
              <option value="Literary Fiction">Literary Fiction</option>
              <option value="Historical Fiction">Historical Fiction</option>
              <option value="Thriller">Thriller</option>
              <option value="Non-Fiction">Non-Fiction</option>
              <option value="Short Stories">Short Stories</option>
              <option value="Other">Other</option>
            </select>
            <button class="rt-tbr-add-btn" id="rt-q-start-btn">Start reading</button>
          </div>
        </div>

      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         TAB 2 â€” TBR
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="rt-panel" id="rt-panel-tbr" data-tab="tbr" style="display:none;">
      <div class="rt-panel-inner">
        <h2 class="rt-panel-title">To be read</h2>

        <div class="rt-tbr-add">
          <input type="text" id="rt-tbr-title"  class="rt-tbr-input" placeholder="Book title..." autocomplete="off">
          <input type="text" id="rt-tbr-author" class="rt-tbr-input" placeholder="Author (optional)" autocomplete="off">
          <button class="rt-tbr-add-btn" id="rt-tbr-add-btn">+ Add</button>
        </div>

        <div id="rt-tbr-list"></div>
        <div class="rt-empty" id="rt-tbr-empty">
          <div class="rt-empty-icon">ðŸ”–</div>
          <p>Your TBR pile is empty â€” <button class="btn-text-link" onclick="switchTab('recs')">get some recommendations â†’</button></p>
        </div>
      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         TAB 3 â€” READ + DNF
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="rt-panel" id="rt-panel-done" data-tab="done" style="display:none;">
      <div class="rt-panel-inner">

        <!-- Stats row -->
        <div class="rt-stats-grid">
          <div class="rt-stat-card rt-stat-goal">
            <div class="rt-stat-label">Reading goal</div>
            <div class="rt-goal-display">
              <span class="rt-goal-current" id="rt-goal-count">0</span>
              <span class="rt-goal-sep">/</span>
              <input type="number" class="rt-goal-input" id="rt-goal-target" value="12" min="1" max="365" aria-label="Yearly goal">
              <span class="rt-goal-unit">books this year</span>
            </div>
            <div class="rt-goal-bar-wrap">
              <div class="rt-goal-bar"><div class="rt-goal-fill" id="rt-goal-fill" style="width:0%"></div></div>
              <span class="rt-goal-pct" id="rt-goal-pct">0%</span>
            </div>
          </div>
          <div class="rt-stat-card">
            <div class="rt-stat-label">This year</div>
            <div class="rt-stat-number" id="rt-this-year">0</div>
            <div class="rt-stat-sub" id="rt-year-label">2026</div>
          </div>
          <div class="rt-stat-card">
            <div class="rt-stat-label">All time</div>
            <div class="rt-stat-number" id="rt-total">0</div>
            <div class="rt-stat-sub">books read</div>
          </div>
          <div class="rt-stat-card">
            <div class="rt-stat-label">Favourites</div>
            <div class="rt-stat-number" id="rt-favourites">0</div>
            <div class="rt-stat-sub">5â˜… reads</div>
          </div>
        </div>

        <!-- Filter tabs -->
        <div class="rt-status-tabs">
          <button class="rt-status-tab active" data-status="read" onclick="setDoneFilter('read')">Finished</button>
          <button class="rt-status-tab" data-status="dnf" onclick="setDoneFilter('dnf')">Did not finish</button>
        </div>

        <div class="rt-list-controls" style="margin-bottom:1rem;">
          <input type="text" class="rt-search" id="rt-search" placeholder="Search..." aria-label="Search">
          <select class="rt-filter-select" id="rt-filter-genre">
            <option value="">All genres</option>
            <option value="Fantasy">Fantasy</option>
            <option value="Science Fiction">Science Fiction</option>
            <option value="Horror">Horror</option>
            <option value="Romance">Romance</option>
            <option value="Dystopian">Dystopian</option>
            <option value="Literary Fiction">Literary Fiction</option>
            <option value="Historical Fiction">Historical Fiction</option>
            <option value="Thriller">Thriller</option>
            <option value="Non-Fiction">Non-Fiction</option>
            <option value="Short Stories">Short Stories</option>
            <option value="Other">Other</option>
          </select>
          <select class="rt-filter-select" id="rt-sort">
            <option value="newest">Newest first</option>
            <option value="oldest">Oldest first</option>
            <option value="rating-high">Top rated</option>
            <option value="title">Aâ€“Z</option>
          </select>
        </div>

        <div id="rt-done-list"></div>
        <div class="rt-empty" id="rt-done-empty">
          <div class="rt-empty-icon">âœ“</div>
          <p id="rt-done-empty-msg">No finished books yet.</p>
        </div>

      </div>
    </div>

    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
         TAB 4 â€” RECOMMENDATIONS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <div class="rt-panel" id="rt-panel-recs" data-tab="recs" style="display:none;">
      <div class="rt-panel-inner">
        <div class="rt-recs-header">
          <div>
            <div class="section-label" style="margin-bottom:0.4rem;">Powered by Claude</div>
            <h2 class="rt-panel-title" style="margin-bottom:0.4rem;">What should I read next?</h2>
            <p class="rt-panel-sub">Claude analyses your reading history â€” ratings, notes, genres you love â€” and suggests books matched to your actual taste.</p>
          </div>
          <div class="rt-ai-badge">AI</div>
        </div>
        <button class="rt-submit-btn" id="rt-ai-btn">âœ¦ Get recommendations</button>
        <div class="rt-ai-output" id="rt-ai-output" style="display:none;"></div>
        <p class="rt-ai-note" id="rt-ai-note" style="display:none;">Recommendations generated by Claude (Anthropic) based on your logged books.</p>
      </div>
    </div>

  </div><!-- /rt-panels -->

  <!-- BOTTOM NAV -->
  <nav class="rt-bottom-nav" aria-label="Tracker navigation">
    <button class="rt-nav-btn active" data-tab="reading" onclick="switchTab('reading')">
      <span class="rt-nav-icon">ðŸ“–</span>
      <span class="rt-nav-label">Reading</span>
    </button>
    <button class="rt-nav-btn" data-tab="tbr" onclick="switchTab('tbr')">
      <span class="rt-nav-icon">ðŸ”–</span>
      <span class="rt-nav-label">TBR</span>
    </button>
    <button class="rt-nav-btn" data-tab="done" onclick="switchTab('done')">
      <span class="rt-nav-icon">âœ“</span>
      <span class="rt-nav-label">Read</span>
    </button>
    <button class="rt-nav-btn" data-tab="recs" onclick="switchTab('recs')">
      <span class="rt-nav-icon">âœ¦</span>
      <span class="rt-nav-label">Recs</span>
    </button>
  </nav>

</div><!-- /rt-app -->

<!-- FINISH BOOK MODAL -->
<div class="rt-modal-overlay" id="rt-modal-overlay" style="display:none;" aria-modal="true" role="dialog">
  <div class="rt-modal">
    <div class="rt-modal-header">
      <h3 id="rt-modal-title">Finished reading?</h3>
      <button class="rt-modal-close" id="rt-modal-close" aria-label="Close">Ã—</button>
    </div>
    <input type="hidden" id="rt-modal-book-id">

    <div class="rt-modal-section" id="rt-modal-read-section">
      <div class="rt-field">
        <label>Your rating</label>
        <div class="rt-stars" id="rt-modal-stars" role="radiogroup">
          <button class="rt-star" data-val="1">â˜…</button>
          <button class="rt-star" data-val="2">â˜…</button>
          <button class="rt-star" data-val="3">â˜…</button>
          <button class="rt-star" data-val="4">â˜…</button>
          <button class="rt-star" data-val="5">â˜…</button>
        </div>
      </div>
      <div class="rt-field" style="margin-top:1rem;">
        <label for="rt-modal-notes">Notes <span class="rt-optional">(optional)</span></label>
        <textarea id="rt-modal-notes" rows="3" placeholder="What did you think? A line or two helps Claude personalise your future recommendations..."></textarea>
      </div>
      <div class="rt-field" style="margin-top:1rem;">
        <label for="rt-modal-date">Date finished</label>
        <input type="date" id="rt-modal-date">
      </div>
    </div>

    <div class="rt-modal-actions">
      <button class="rt-modal-btn rt-modal-btn--read"  id="rt-modal-mark-read">Mark as read âœ“</button>
      <button class="rt-modal-btn rt-modal-btn--dnf"   id="rt-modal-mark-dnf">Did not finish</button>
      <button class="rt-modal-btn rt-modal-btn--cancel" id="rt-modal-cancel">Cancel</button>
    </div>
  </div>
</div>

<div class="rt-install-strip" id="rt-install-strip">
  <div class="rt-install-strip-inner">
    <span>ðŸ“± <strong>Add to home screen</strong> â€” your data saves automatically in your browser.</span>
    <span id="rt-install-chrome" style="display:none;"><button class="rt-install-btn" id="rt-install-btn">Install app</button></span>
    <em class="rt-ios-hint">iPhone: Share â†’ "Add to Home Screen"</em>
  </div>
</div>

<script>
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DATA MODEL
// book = { id, title, author, genre, status,
//          rating, notes, date, dateStarted, added }
// status: 'tbr' | 'reading' | 'read' | 'dnf'
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const SK = 'ctb_tracker_v2';
const GK = 'ctb_reading_goal_v1';

let books = [];
let modalRating = 0;
let doneFilter  = 'read';

function save()     { try { localStorage.setItem(SK, JSON.stringify(books)); } catch(e){} }
function load()     { try { books = JSON.parse(localStorage.getItem(SK)) || []; } catch(e){ books=[]; }
                      // migrate old data if present
                      try { const old = JSON.parse(localStorage.getItem('ctb_reading_tracker_v1'));
                        if (old && old.length && !books.length) {
                          books = old.map(b=>({...b, status:'read'})); save();
                        }} catch(e){} }
function saveGoal(v){ try { localStorage.setItem(GK,v); } catch(e){} }
function loadGoal() { try { return parseInt(localStorage.getItem(GK))||12; } catch(e){return 12;} }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// HELPERS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function esc(s) { const d=document.createElement('div'); d.appendChild(document.createTextNode(s||'')); return d.innerHTML; }
function fmtDate(s){ return s ? new Date(s+'T12:00:00').toLocaleDateString('en-GB',{day:'numeric',month:'short',year:'numeric'}) : ''; }
function uid() { return Date.now() + Math.random(); }

function getBooks(status) { return books.filter(b=>b.status===status); }

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TAB SWITCHING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function switchTab(name) {
  document.querySelectorAll('.rt-panel').forEach(p=>p.style.display='none');
  document.querySelectorAll('.rt-nav-btn').forEach(b=>b.classList.remove('active'));
  document.getElementById('rt-panel-'+name).style.display='block';
  document.querySelector(`.rt-nav-btn[data-tab="${name}"]`).classList.add('active');
  if (name==='reading') renderReading();
  if (name==='tbr')     renderTBR();
  if (name==='done')    { updateStats(); renderDone(); }
  if (name==='recs')    {}
  window.scrollTo({top:document.querySelector('.rt-app').offsetTop-80,behavior:'smooth'});
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// STATS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function updateStats() {
  const year = new Date().getFullYear();
  const read  = getBooks('read');
  const ty    = read.filter(b=>b.date && new Date(b.date).getFullYear()===year);
  const fav   = read.filter(b=>b.rating===5);
  const goal  = parseInt(document.getElementById('rt-goal-target').value)||12;
  const pct   = Math.min(100,Math.round((ty.length/goal)*100));
  document.getElementById('rt-year-label').textContent  = year;
  document.getElementById('rt-total').textContent       = read.length;
  document.getElementById('rt-this-year').textContent   = ty.length;
  document.getElementById('rt-favourites').textContent  = fav.length;
  document.getElementById('rt-goal-count').textContent  = ty.length;
  document.getElementById('rt-goal-fill').style.width   = pct+'%';
  document.getElementById('rt-goal-pct').textContent    = pct+'%';
}

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// CURRENTLY READING
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderReading() {
  const reading = getBooks('reading');
  const list  = document.getElementById('rt-reading-list');
  const empty = document.getElementById('rt-reading-empty');
  empty.style.display = reading.length ? 'none' : 'flex';

  list.innerHTML = reading.map(b=>`
    <div class="rt-book-item rt-reading-item">
      <div class="rt-reading-badge">Currently reading</div>
      <div class="rt-book-main">
        <div class="rt-book-info">
          <div class="rt-book-title">${esc(b.title)}</div>
          ${b.author?`<div class="rt-book-author">${esc(b.author)}</div>`:''}
          ${b.dateStarted?`<div class="rt-book-date">Started ${fmtDate(b.dateStarted)}</div>`:''}
        </div>
        <div class="rt-book-meta rt-book-meta--col">
          <button class="rt-finish-btn" data-id="${b.id}">Finished?</button>
          <button class="rt-delete" data-id="${b.id}" data-action="remove-reading" title="Remove">Ã—</button>
        </div>
      </div>
    </div>`).join('');
}

document.getElementById('rt-reading-list').addEventListener('click', function(e) {
  const finBtn = e.target.closest('.rt-finish-btn');
  if (finBtn) { openModal(parseInt(finBtn.dataset.id)); return; }

  const delBtn = e.target.closest('.rt-delete[data-action="remove-reading"]');
  if (delBtn) {
    if (confirm('Remove from currently reading?')) {
      books = books.filter(b=>b.id!==parseInt(delBtn.dataset.id));
      save(); renderReading();
    }
  }
});

// Quick-start reading
document.getElementById('rt-q-start-btn').addEventListener('click', function() {
  const title = document.getElementById('rt-q-title').value.trim();
  if (!title) { document.getElementById('rt-q-title').focus(); return; }
  books.unshift({ id:uid(), title, author:document.getElementById('rt-q-author').value.trim(), genre:document.getElementById('rt-q-genre').value, status:'reading', dateStarted:new Date().toISOString().split('T')[0], added:new Date().toISOString() });
  save();
  ['rt-q-title','rt-q-author'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('rt-q-genre').value='';
  renderReading();
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// TBR
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderTBR() {
  const tbr  = getBooks('tbr');
  const list  = document.getElementById('rt-tbr-list');
  const empty = document.getElementById('rt-tbr-empty');
  empty.style.display = tbr.length ? 'none' : 'flex';

  list.innerHTML = tbr.map(b=>`
    <div class="rt-book-item">
      <div class="rt-book-main">
        <div class="rt-book-info">
          <div class="rt-book-title">${esc(b.title)}</div>
          ${b.author?`<div class="rt-book-author">${esc(b.author)}</div>`:''}
        </div>
        <div class="rt-book-meta">
          <button class="rt-start-reading-btn" data-id="${b.id}">ðŸ“– Start reading</button>
          <button class="rt-delete" data-id="${b.id}" data-action="remove-tbr" title="Remove">Ã—</button>
        </div>
      </div>
    </div>`).join('');
}

document.getElementById('rt-tbr-add-btn').addEventListener('click', addToTBR);
document.getElementById('rt-tbr-author').addEventListener('keydown', e=>{ if(e.key==='Enter') addToTBR(); });
document.getElementById('rt-tbr-title').addEventListener('keydown',  e=>{ if(e.key==='Enter') addToTBR(); });

function addToTBR() {
  const title = document.getElementById('rt-tbr-title').value.trim();
  if (!title) { document.getElementById('rt-tbr-title').focus(); return; }
  books.push({ id:uid(), title, author:document.getElementById('rt-tbr-author').value.trim(), status:'tbr', added:new Date().toISOString() });
  save();
  document.getElementById('rt-tbr-title').value='';
  document.getElementById('rt-tbr-author').value='';
  renderTBR();
}

// Add to TBR from recommendations
function addRecToTBR(title, author) {
  books.push({ id:uid(), title, author:author||'', status:'tbr', added:new Date().toISOString() });
  save();
  // Brief feedback
  const btn = document.querySelector(`.rt-rec-add-btn[data-title="${CSS.escape(title)}"]`);
  if (btn) { btn.textContent='âœ“ Added'; btn.disabled=true; }
}

document.getElementById('rt-tbr-list').addEventListener('click', function(e) {
  const startBtn = e.target.closest('.rt-start-reading-btn');
  if (startBtn) {
    const id = parseInt(startBtn.dataset.id);
    const book = books.find(b=>b.id===id);
    if (book) { book.status='reading'; book.dateStarted=new Date().toISOString().split('T')[0]; save(); renderTBR(); }
    return;
  }
  const delBtn = e.target.closest('.rt-delete[data-action="remove-tbr"]');
  if (delBtn) {
    books = books.filter(b=>b.id!==parseInt(delBtn.dataset.id));
    save(); renderTBR();
  }
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// DONE LIST (read + dnf)
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let doneFilterCurrent = 'read';

function setDoneFilter(status) {
  doneFilterCurrent = status;
  document.querySelectorAll('.rt-status-tab').forEach(t=>t.classList.toggle('active', t.dataset.status===status));
  document.getElementById('rt-done-empty-msg').textContent = status==='read' ? 'No finished books yet.' : 'No DNF books.';
  renderDone();
}

function renderDone() {
  const q  = document.getElementById('rt-search').value.toLowerCase();
  const gf = document.getElementById('rt-filter-genre').value;
  const so = document.getElementById('rt-sort').value;

  let f = books.filter(b=>b.status===doneFilterCurrent)
    .filter(b => (!q || b.title.toLowerCase().includes(q)||(b.author||'').toLowerCase().includes(q)) && (!gf||b.genre===gf))
    .sort((a,b)=>{
      if(so==='newest')      return new Date(b.date||b.added)-new Date(a.date||a.added);
      if(so==='oldest')      return new Date(a.date||a.added)-new Date(b.date||b.added);
      if(so==='rating-high') return (b.rating||0)-(a.rating||0);
      if(so==='title')       return a.title.localeCompare(b.title);
      return 0;
    });

  const list  = document.getElementById('rt-done-list');
  const empty = document.getElementById('rt-done-empty');
  empty.style.display = f.length ? 'none' : 'flex';
  if (!f.length) { list.innerHTML=''; return; }

  list.innerHTML = f.map(b=>`
    <div class="rt-book-item ${b.status==='dnf'?'rt-book-item--dnf':''}">
      <div class="rt-book-main">
        <div class="rt-book-info">
          <div class="rt-book-title">${esc(b.title)} ${b.status==='dnf'?'<span class="rt-dnf-label">DNF</span>':''}</div>
          ${b.author?`<div class="rt-book-author">${esc(b.author)}</div>`:''}
        </div>
        <div class="rt-book-meta">
          ${b.genre ?`<span class="rt-book-genre">${esc(b.genre)}</span>`:''}
          ${b.rating?`<span class="rt-book-stars">${'â˜…'.repeat(b.rating)}${'â˜†'.repeat(5-b.rating)}</span>`:''}
          ${b.date  ?`<span class="rt-book-date">${fmtDate(b.date)}</span>`:''}
          <button class="rt-delete" data-id="${b.id}" data-action="remove-done" title="Remove">Ã—</button>
        </div>
      </div>
      ${b.notes?`<div class="rt-book-notes">${esc(b.notes)}</div>`:''}
    </div>`).join('');
}

document.getElementById('rt-done-list').addEventListener('click', function(e) {
  const delBtn = e.target.closest('.rt-delete[data-action="remove-done"]');
  if (delBtn) {
    if (confirm('Remove this book?')) {
      books = books.filter(b=>b.id!==parseInt(delBtn.dataset.id));
      save(); renderDone(); updateStats();
    }
  }
});

document.getElementById('rt-search').addEventListener('input', renderDone);
document.getElementById('rt-filter-genre').addEventListener('change', renderDone);
document.getElementById('rt-sort').addEventListener('change', renderDone);

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// FINISH MODAL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openModal(bookId) {
  const book = books.find(b=>b.id===bookId);
  if (!book) return;
  document.getElementById('rt-modal-book-id').value = bookId;
  document.getElementById('rt-modal-title').textContent = `"${book.title}"`;
  document.getElementById('rt-modal-notes').value = '';
  document.getElementById('rt-modal-date').value  = new Date().toISOString().split('T')[0];
  setModalStars(0);
  document.getElementById('rt-modal-overlay').style.display='flex';
  document.body.style.overflow='hidden';
}

function closeModal() {
  document.getElementById('rt-modal-overlay').style.display='none';
  document.body.style.overflow='';
}

document.getElementById('rt-modal-close').addEventListener('click', closeModal);
document.getElementById('rt-modal-cancel').addEventListener('click', closeModal);
document.getElementById('rt-modal-overlay').addEventListener('click', function(e){ if(e.target===this) closeModal(); });

function setModalStars(v) {
  modalRating = v;
  document.querySelectorAll('#rt-modal-stars .rt-star').forEach((s,i)=>s.classList.toggle('active',i<v));
}
const ms = document.getElementById('rt-modal-stars');
ms.addEventListener('click', e=>{ const b=e.target.closest('.rt-star'); if(!b) return; const v=parseInt(b.dataset.val); setModalStars(modalRating===v?0:v); });
ms.addEventListener('mouseover', e=>{ const b=e.target.closest('.rt-star'); if(!b) return; const v=parseInt(b.dataset.val); document.querySelectorAll('#rt-modal-stars .rt-star').forEach((s,i)=>s.classList.toggle('hover',i<v)); });
ms.addEventListener('mouseleave', ()=>document.querySelectorAll('#rt-modal-stars .rt-star').forEach(s=>s.classList.remove('hover')));

document.getElementById('rt-modal-mark-read').addEventListener('click', function() {
  const id   = parseInt(document.getElementById('rt-modal-book-id').value);
  const book = books.find(b=>b.id===id);
  if (!book) return;
  book.status = 'read';
  book.rating = modalRating || null;
  book.notes  = document.getElementById('rt-modal-notes').value.trim();
  book.date   = document.getElementById('rt-modal-date').value;
  save(); closeModal(); renderReading(); updateStats();
  // Show confirmation
  const flash = document.createElement('div');
  flash.className='rt-flash'; flash.textContent=`âœ“ "${book.title}" marked as read!`;
  document.querySelector('.rt-app').prepend(flash);
  setTimeout(()=>flash.remove(), 3000);
});

document.getElementById('rt-modal-mark-dnf').addEventListener('click', function() {
  const id   = parseInt(document.getElementById('rt-modal-book-id').value);
  const book = books.find(b=>b.id===id);
  if (!book) return;
  book.status = 'dnf';
  book.notes  = document.getElementById('rt-modal-notes').value.trim() || null;
  book.date   = new Date().toISOString().split('T')[0];
  save(); closeModal(); renderReading();
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// AI RECOMMENDATIONS
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.getElementById('rt-ai-btn').addEventListener('click', async function() {
  const read = getBooks('read');

  if (!read.length && !getBooks('reading').length) {
    const o = document.getElementById('rt-ai-output');
    o.style.display='block';
    o.innerHTML='<p class="rt-ai-msg">Start reading or log some finished books first â€” Claude needs something to work with!</p>';
    return;
  }

  const btn    = this;
  btn.disabled = true; btn.textContent='âœ¦ Thinking...';
  const output = document.getElementById('rt-ai-output');
  const note   = document.getElementById('rt-ai-note');
  output.style.display='block';
  output.innerHTML='<div class="rt-ai-loading"><span></span><span></span><span></span></div>';
  note.style.display='none';

  const topRated  = read.filter(b=>b.rating>=4).slice(0,8);
  const sample    = topRated.length ? topRated : read.slice(0,6);
  const dnf       = getBooks('dnf').slice(0,4);
  const reading   = getBooks('reading').slice(0,3);
  const tbr       = getBooks('tbr').slice(0,5);
  const genres    = [...new Set(books.map(b=>b.genre).filter(Boolean))];

  const fmtBook = b => `"${b.title}"${b.author?` by ${b.author}`:''}${b.genre?` (${b.genre})`:''}${b.rating?` ${b.rating}/5â˜…`:''}${b.notes?` â€” "${b.notes}"`:''}`; 

  const prompt = `You are a knowledgeable book recommender. Here is a reader's full reading history:

ENJOYED (rated 4-5â˜…):
${sample.map(fmtBook).join('\n') || 'None yet'}

CURRENTLY READING:
${reading.map(b=>fmtBook(b)).join('\n') || 'Nothing'}

DID NOT FINISH:
${dnf.map(b=>`"${b.title}"${b.notes?` â€” stopped because: "${b.notes}"`:''}` ).join('\n') || 'None'}

WANTS TO READ (TBR):
${tbr.map(b=>b.title).join(', ') || 'None listed'}

Genres they read: ${genres.join(', ')||'mixed'}
Total finished: ${read.length}

Based on all of this, recommend exactly 4 books they would love â€” taking into account what they've DNF'd to avoid those patterns. For each recommendation give: the title and author in bold, one specific sentence explaining why it fits their taste referencing something they've actually read, and one sentence on what makes the book special. Number them 1â€“4. End with a single line suggesting which TBR book they should pick up first if any were listed (skip this if TBR is empty). Warm, direct tone like a well-read friend.`;

  try {
    const res  = await fetch('https://api.anthropic.com/v1/messages',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({model:'claude-sonnet-4-20250514',max_tokens:1200,messages:[{role:'user',content:prompt}]})});
    const data = await res.json();
    const text = data.content?.find(c=>c.type==='text')?.text||'';
    if (!text) throw new Error('empty');

    // Parse recommendations to add "Add to TBR" buttons
    // Split on numbered items and render with action buttons
    const html = text
      .replace(/\*\*(.+?)\*\*/g,'<strong>$1</strong>')
      .split('\n\n')
      .map(p => {
        const isRec = /^\d+\./.test(p.trim());
        if (isRec) {
          // Extract title for TBR button (first bold text)
          const titleMatch = p.match(/<strong>([^<]+)<\/strong>/);
          const title = titleMatch ? titleMatch[1].split(' by ')[0].replace(/["""]/g,'').trim() : '';
          const authorMatch = p.match(/by ([^<\n,]+)/i);
          const author = authorMatch ? authorMatch[1].trim() : '';
          const addBtn = title ? `<button class="rt-rec-add-btn" data-title="${esc(title)}" data-author="${esc(author)}" onclick="addRecToTBR('${title.replace(/'/g,"\\'")}','${author.replace(/'/g,"\\'")}')">+ Add to TBR</button>` : '';
          return `<div class="rt-rec-item"><p>${p}</p>${addBtn}</div>`;
        }
        return `<p>${p}</p>`;
      }).join('');

    output.innerHTML=`<div class="rt-ai-response">${html}</div>`;
    note.style.display='block';
  } catch(e) {
    output.innerHTML='<p class="rt-ai-msg">Couldn\'t get recommendations right now â€” please try again.</p>';
  }
  btn.disabled=false; btn.textContent='âœ¦ Get new recommendations';
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// GOAL
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const gi = document.getElementById('rt-goal-target');
gi.value = loadGoal();
gi.addEventListener('change', function(){ saveGoal(this.value); updateStats(); });

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// PWA
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let deferredPrompt=null;
window.addEventListener('beforeinstallprompt',function(e){
  e.preventDefault(); deferredPrompt=e;
  document.getElementById('rt-install-chrome').style.display='inline';
});
document.getElementById('rt-install-btn')?.addEventListener('click',async function(){
  if(!deferredPrompt) return;
  deferredPrompt.prompt();
  const {outcome}=await deferredPrompt.userChoice;
  deferredPrompt=null;
  if(outcome==='accepted') document.getElementById('rt-install-strip').style.display='none';
});

// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// INIT
// â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
load();
renderReading();
updateStats();
</script>
